# 38 - 브라우저 렌더링 과정

1. 브라우저는 HTML, CSS, JS, 이미지, 폰트 파일 등 렌더링에 필요한 리소스를 요청하고 서버로부터 응답을 받는다.
2. 브라우저의 렌더링 엔진은 서버로부터 응답된 HTML과 CSS를 파싱하여 **DOM과 CSSOM**을 생성하고 이들을 결합하여 렌더 트리를 생성한다.
3. 브라우저의 자바스크립트 엔진은 서버로부터 응답된 자바스크립트를 파싱하여 AST(Abstract Syntax Tree) 를 생성하고 바이트코드로 변환하여 실행한다. 이때 자바스크립트는 DOM API를 통해 DOM이나 CSSOM을 변경할 수 있다. 변경된 DOM과 CSSOM은 다시 **렌더 트리로 결합**된다.
4. 렌더 트리를 기반으로 HTML 요소의 레이아웃을 계산하고 브라우저 화면에 **HTML 요소를 페인팅**한다.

## **38.1 요청과 응답**

브라우저의 주소창에 `URL`을 입력하고 엔터 키를 누르면 `URL`의 호스트 이름이 `DNS`를 통해 `IP` 주소로 변환되고 이 `IP` 주소를 갖는 서버에게 요청을 전송한다.

## **38.2 HTTP 1.1 과 HTTP 2.0**

`HTTP`는 웹에서 브라우저와 서버가 통신하기 위한 프로토콜이다.

### HTTP 1.1 과 HTTP 2.0의 차이점

- `HTTP` 1.1은 기본적으로 커넥션당 하나의 요청과 응답만 처리한다.

- `HTTP/2`는 커넥션당 여러 개의 요청과 응답, 즉 다중 요청/응답이 가능하다.
    - 따라서 `HTTP 2.0` 은 여러 리소스의 `동시 전송이 가능`하므로 `HTTP 1.1`에 비해 페이지 로드 속도가 약 50% 정도 빠르다고 알려져 있다.

## **38.3 HTML 파싱과 DOM 생성**

![image.png](38%20-%20%E1%84%87%E1%85%B3%E1%84%85%E1%85%A1%E1%84%8B%E1%85%AE%E1%84%8C%E1%85%A5%20%E1%84%85%E1%85%A6%E1%86%AB%E1%84%83%E1%85%A5%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A5%E1%86%BC%20be3b175ea2d144039ccb12f58b7b6fc5/image.png)

## **38.4 CSS 파싱과 CSSOM 생성**

![image.png](38%20-%20%E1%84%87%E1%85%B3%E1%84%85%E1%85%A1%E1%84%8B%E1%85%AE%E1%84%8C%E1%85%A5%20%E1%84%85%E1%85%A6%E1%86%AB%E1%84%83%E1%85%A5%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A5%E1%86%BC%20be3b175ea2d144039ccb12f58b7b6fc5/image%201.png)

HTML을 한 줄 씩 읽고 있던 렌더링 엔진은 `DOM을` 생성해 나가다가  ——————

CSS를 로드하는 **link 태그**나 **style 태그**를 만나면 DOM 생성을 일시 중단함. 

-`CSSOM`을 생성

## 38.5 렌더 트리 생성

- 렌더링 엔진은 서버로부터 응답된 `HTML`과 `CSS`를 파싱하여 각각 `DOM`과 `CSSOM`를 생성한다.
    - 그리고 `DOM`  + `CSSOM` ⇒`렌더 트리`로 결합된다.

+)  브라우저 화면에 렌더링되는 노드만으로 구성 ( meta태그 display : none 제외 )

![image.png](38%20-%20%E1%84%87%E1%85%B3%E1%84%85%E1%85%A1%E1%84%8B%E1%85%AE%E1%84%8C%E1%85%A5%20%E1%84%85%E1%85%A6%E1%86%AB%E1%84%83%E1%85%A5%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A5%E1%86%BC%20be3b175ea2d144039ccb12f58b7b6fc5/image%202.png)

## **38.6 자바스크립트 파싱과 실행**

## 38.6 자바스크립트 파싱과 실행

- DOM은 HTML 문서의 구조와 정보뿐만 아니라 HTML 요소와 스타일 등을 변경할 수 있는 프로그래밍 인터페이스로서 `DOM API`를 제공한다.
    - 즉, 자바스크립트 코드에서 `DOM API`를 사용하면 이미 생성된 DOM을 동적으로 조작할 수 있다.

- DOM은 html생성한건데 스타일어케바꿈요?
    
    Html 요소를 선택하여 스타일 지정가능 
    

 한 줄 씩 읽다가 스크립트 태그를 만나면 자바스크립트 코드를 파싱하기 위해 `자바스크립트 엔진`에 제어권을 넘긴다.

![image.png](38%20-%20%E1%84%87%E1%85%B3%E1%84%85%E1%85%A1%E1%84%8B%E1%85%AE%E1%84%8C%E1%85%A5%20%E1%84%85%E1%85%A6%E1%86%AB%E1%84%83%E1%85%A5%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A5%E1%86%BC%20be3b175ea2d144039ccb12f58b7b6fc5/image%203.png)

자바스크립트 엔진은 자바스크립트를 해석하여 AST(추상 구문 트리)를 생성한다. 그리고 AST를 기반으로 인터프리터가 실행할 수 있는 중간 코드인 바이트코드를 생성하여 실행한다.

## 38.7 리플로우와 리페인트

- 만약 자바스크립트 코드에 DOM이나 CSSOM을 변경하는 `DOM API`가 사용된 경우 DOM이나 CSSOM이 변경된다.

![image.png](38%20-%20%E1%84%87%E1%85%B3%E1%84%85%E1%85%A1%E1%84%8B%E1%85%AE%E1%84%8C%E1%85%A5%20%E1%84%85%E1%85%A6%E1%86%AB%E1%84%83%E1%85%A5%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A5%E1%86%BC%20be3b175ea2d144039ccb12f58b7b6fc5/image%204.png)

## 38.8 자바스크립트 파싱에 의한 HTML 파싱 중단

- 렌더링 엔진과 자바스크립트 엔진은 병렬적으로 파싱을 실행하지 않고 `직렬적으로` 파싱을 수행한다.

![image.png](38%20-%20%E1%84%87%E1%85%B3%E1%84%85%E1%85%A1%E1%84%8B%E1%85%AE%E1%84%8C%E1%85%A5%20%E1%84%85%E1%85%A6%E1%86%AB%E1%84%83%E1%85%A5%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A5%E1%86%BC%20be3b175ea2d144039ccb12f58b7b6fc5/image%205.png)

## 38.9 script 태그의 async/defer 어트리뷰트 (비동기)

- 앞에서 살펴본 자바스크립트 파싱에 의한 DOM 생성이 중단되는 문제를 근본적으로 해결하기 위해 HTML5부터 script 태그에 `async`와 `defer` 어트리뷰트가 추가되었다.

### async

- 자바스크립트의 파싱과 실행은 `자바스크립트 파일의 로드가 완료된 직후` 진행되며, 이때 HTML 파싱이 중단된다.
- 순서가 보장이 안됨.

![image.png](38%20-%20%E1%84%87%E1%85%B3%E1%84%85%E1%85%A1%E1%84%8B%E1%85%AE%E1%84%8C%E1%85%A5%20%E1%84%85%E1%85%A6%E1%86%AB%E1%84%83%E1%85%A5%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A5%E1%86%BC%20be3b175ea2d144039ccb12f58b7b6fc5/image%206.png)

### **defer**

자바스크립트의 파싱과 실행은 HTML 파싱이 완료된 직후, 즉 `DOM 생성이 완료된 직후` 진행된다.

- DOM생성 이후에 실행되는 스크립트에 유용

![image.png](38%20-%20%E1%84%87%E1%85%B3%E1%84%85%E1%85%A1%E1%84%8B%E1%85%AE%E1%84%8C%E1%85%A5%20%E1%84%85%E1%85%A6%E1%86%AB%E1%84%83%E1%85%A5%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A5%E1%86%BC%20be3b175ea2d144039ccb12f58b7b6fc5/image%207.png)